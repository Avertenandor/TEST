<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Module Loading</title>
</head>
<body>
    <h1>Тест загрузки модулей</h1>
    <div id="results"></div>
    
    <script type="module">
        const results = document.getElementById('results');
        
        function log(message, isError = false) {
            const p = document.createElement('p');
            p.textContent = message;
            p.style.color = isError ? 'red' : 'green';
            results.appendChild(p);
            console.log(message);
        }
        
        // Тест 1: Проверка путей
        log('=== Тест 1: Проверка путей ===');
        log('Текущий URL: ' + window.location.href);
        log('Базовый путь: ' + window.location.origin);
        
        // Тест 2: Загрузка core модулей
        log('=== Тест 2: Загрузка core модулей ===');
        
        try {
            const { EventBus } = await import('./core/event-bus.js');
            log('✅ EventBus загружен успешно');
        } catch (error) {
            log('❌ EventBus ошибка: ' + error.message, true);
        }
        
        try {
            const { Store } = await import('./core/store.js');
            log('✅ Store загружен успешно');
        } catch (error) {
            log('❌ Store ошибка: ' + error.message, true);
        }
        
        // Тест 3: Загрузка модуля dashboard
        log('=== Тест 3: Загрузка модуля dashboard ===');
        
        try {
            // Попробуем загрузить напрямую
            const response = await fetch('/modules/dashboard/index.js');
            const text = await response.text();
            
            log('Статус ответа: ' + response.status);
            log('Тип контента: ' + response.headers.get('content-type'));
            
            if (text.startsWith('<!DOCTYPE') || text.startsWith('<')) {
                log('❌ Получен HTML вместо JavaScript!', true);
                log('Первые 100 символов: ' + text.substring(0, 100), true);
            } else {
                log('✅ Получен JavaScript файл');
                
                // Теперь попробуем импортировать
                const dashboardModule = await import('./modules/dashboard/index.js');
                log('✅ Dashboard модуль загружен успешно');
            }
        } catch (error) {
            log('❌ Dashboard ошибка: ' + error.message, true);
        }
        
        // Тест 4: Проверка других модулей
        log('=== Тест 4: Проверка auth модуля ===');
        
        try {
            const authModule = await import('./modules/auth/index.js');
            log('✅ Auth модуль загружен успешно');
        } catch (error) {
            log('❌ Auth ошибка: ' + error.message, true);
        }
        
        // Тест 5: Проверка shared компонентов
        log('=== Тест 5: Проверка shared компонентов ===');
        
        try {
            const modal = await import('./shared/components/modal.js');
            log('✅ Modal компонент загружен успешно');
        } catch (error) {
            log('❌ Modal ошибка: ' + error.message, true);
        }
    </script>
</body>
</html>